package appiumTests;
import io.appium.java_client.AppiumBy;
import io.appium.java_client.android.AndroidDriver;
import io.appium.java_client.android.options.UiAutomator2Options;
import org.junit.jupiter.api.*;
import org.openqa.selenium.WebElement;
import java.net.MalformedURLException;
import java.net.URL;
import java.time.Duration;

import static org.junit.jupiter.api.Assertions.assertTrue;

public class UIVisibilityTest {
    private static AndroidDriver driver;

    @BeforeAll
    public static void setUp() throws MalformedURLException {
        UiAutomator2Options options = new UiAutomator2Options()
                .setDeviceName("96574227740039M")
                .setPlatformName("Android")
                .setApp("/Users/user/Downloads/appPasportThree.apk");

        driver = new AndroidDriver(new URL("http://127.0.0.1:4723/"), options);
        driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(10));
    }

    @AfterAll
    public static void tearDown() {
        if (driver != null) {
            driver.quit();
        }
    }

    @Test
    @DisplayName("Проверка видимости кнопок, текстового поля и заголовка")
    public void testElementsVisibly() {
        WebElement header = driver.findElement(
                AppiumBy.androidUIAutomator("new UiSelector().text(\"Pasport - your digital protection\")"));
        assertTrue(header.isDisplayed(), "Заголовок должен быть видим");

        WebElement textField = driver.findElement(
                AppiumBy.androidUIAutomator("new UiSelector().textContains(\"multifactor authentication\")"));
        assertTrue(textField.isDisplayed(), "Текстовое поле должно быть видно");

        WebElement checkboxText = driver.findElement(
                AppiumBy.androidUIAutomator("new UiSelector().textContains(\"Privacy Policy\")"));
        assertTrue(checkboxText.isDisplayed(), "Текстовое поле рядом с чекбоксом должно быть видно");

        WebElement checkbox = driver.findElement(
                AppiumBy.androidUIAutomator("new UiSelector().checkable(true).checked(false)")
        );
        checkbox.click();

        WebElement signInButton = driver.findElement(AppiumBy.androidUIAutomator("new UiSelector().className(\"android.view.View\").instance(5)"));
        assertTrue(signInButton.isDisplayed(), "Кнопка должна быть видимой");
        signInButton.click();
    }
}
